---
layout: post
title: 데이터베이스 테스트 - 10장
tags:
  [
    목,
    단위 테스트,
    통합 테스트,
    스파이,
    어댑터,
    테스트,
    테스팅,
    Mock,
    test,
    testing,
    unit test,
    integration test,
  ]
date: 2023-09-22 12:00:00 +0900
---

10장 데이터베이스 테스트
단위테스트 (블라디미르 코리코프)

---

> **10장에서 다루는 내용**
>
> - 데이터베이스 테스트를 위한 전제 조건
> - 데이터베이스 테스트 모범 사례
> - 테스트 데이터 생명 주기
> - 테스트 내 데이터베이스 트랜잭션 관리

통합 테스트 라는 퍼즐의 마지막 조각은 프로세스 외부 관리 의존성이다. 가장 일반적인 예시는 애플리케이션 데이터베이스다. 애플리케이션 데이터베이스는 다른 애플리케이션이 접근할 수 없는 데이터베이스다.

실제 데이터베이스를 테스트하면 회귀 방지가 아주 뛰어나지만 설정하기가 쉽지 않다. 이 장에서는 데이터베이스 테스트를 시작하기 전에 거쳐야 할 준비 단계를 살펴본다. 데이터베이스 스키마(schema)를 추적하고, 상태 기반 데이터베이스 배포 방식과 마이그레이션 기반 데이터베이스 배포 방식의 차이점을 설명하며, 상태 기반보다 마이그레이션 기반을 선택해야 하는 이유를 알아본다.

기본 지식을 학습한 후 테스트 중에 트랜잭션을 관리하는 방법과 남은 데이터를 정리하는 방법, 그리고 중요하지 않은 부분을 제거하고 필수 요소를 강조해 테스트를 작게 할 수 있는 방법을 살펴본다.

# 10.1 데이터베이스 테스트를 위한 전제 조건

통합 테스트에서는 관리 의존성이 그대로 있어야 한다. 관리 의존성에는 목을 사용하는 것은 불가능하기 때문에 비관리 의존성보다 작업하기가 더 힘들 수 있다. 그러나 테스트를 작성하기 전에 통합 테스트가 가능하게끔 준비 단계를 수행해야 한다.

이 절에서는 다음 과 같은 전제 조건을 살펴본다.

- 형상 관리 시스템에 데이터베이스를 유지
- 모든 개발자를 위한 별도의 데이터베이스 인스턴스 사용
- 데이터베이스 배포에 마이그레이션 기반 방식 적용

다른 것들과 마찬가지로 테스트를 용이하게 하면 보통 데이터베이스 상태도 개선된다.

## 10.1.1 데이터베이스를 형상 관리 시스템에 유지

데이터베이스를 테스트하는 방법의 첫 번쨰 단계는 데이터베이스 스키마를 일반 코드로 취급하는 것이다. 일반 코드와 마찬가지로 데이터베이스 스키마를 Git과 같은 형상 관리 시스템에 저장하는 것이 최선이다.

모델 데이터베이스를 사용하는 것은 데이터베이스 스키마를 유지하는데 상당히 좋지 못한 방법이다.
이유는 다음과 같다.

- **변경 내역 부재**: 데이터베이스 스키마를 과거의 특정 시점으로 되돌릴 수 없다. 이는 운영 환경에서 버그를 재현할 때 중요할 수 있다.
- **복수의 원천 정보**: 모델 데이터베이스는 개발 상태에 대한 원천 정보를 둘러싸고 경합하게 된다. 이렇게 기준을 두 가지(Git과 모델 데이터베이스)로 두면 부담이 가중된다.

반면 모든 데이터베이스 스키마 업데이트를 형상 관리 시스템에 두면 원천 정보를 하나로 할 수 있고, 일반 코드 변경과 함께 데이터베이스 변경을 추적할 수 있다. 형상 관리 외부에서는 데이터베이스 구조를 수정하면 안 된다.

## 10.1.2 참조 데이터도 데이터베이스 스키마다

**데이터베이스 스키마** 와 관련해서는, 일반적으로 테이블, 뷰, 인덱스, 저장 프로시저 및 데이터베이스의 구조를 형성하는 기타 다른 요소들이 고려됩니다. [\*번역수정](#번역수정)

# 주석

## 번역수정

> 번역본에서는 아래와 같이 번역되어 있음  
> _데이터베이스 스키마에 관해 유력한 용의자는 테이블, 뷰, 인덱스, 저장 프로시저 그리고 데이터베이스가 어떻게 구성되는지에 대한 청사진을 형성하는 나머지 모든 것이다._
>
> 원문은 다음과 같음  
> _When it comes to the database schema, the usual suspects are tables, views, indexes, stored procedures, and anything else that forms a blueprint of how the database is constructed._
>
> 무슨 의미인지 와닿지 않아서 수정함.
